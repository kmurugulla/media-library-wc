<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Library - WordPress Integration</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #059669;
            color: white;
            padding: 20px;
            text-align: center;
        }
        .controls {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
        }
        .control-group {
            margin-bottom: 15px;
        }
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #374151;
        }
        .control-group input, .control-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .btn-primary {
            background: #059669;
            color: white;
        }
        .btn-primary:hover {
            background: #047857;
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        .btn-secondary:hover {
            background: #4b5563;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .media-library-container {
            padding: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-size: 14px;
        }
        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        .status.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #86efac;
        }
        .status.error {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fca5a5;
        }
        .info-box {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .info-box h3 {
            margin: 0 0 10px 0;
            color: #0c4a6e;
        }
        .info-box p {
            margin: 0;
            color: #075985;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Media Library - WordPress Integration</h1>
            <p>Example showing how to integrate the Media Library with WordPress REST API</p>
        </div>

        <div class="controls">
            <div class="info-box">
                <h3>WordPress REST API Integration</h3>
                <p>This example demonstrates how to use the Media Library with WordPress sites that have the REST API enabled. The WordPress source will automatically discover posts, pages, and media items through the WordPress REST API endpoints.</p>
            </div>

            <div class="control-group">
                <label for="wordpress-url">WordPress Site URL:</label>
                <input 
                    type="url" 
                    id="wordpress-url" 
                    placeholder="https://your-wordpress-site.com"
                    value="https://wordpress.org"
                >
            </div>
            <div class="control-group">
                <label>Content Types to Scan:</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="scan-posts" checked>
                        <label for="scan-posts">Posts</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="scan-pages" checked>
                        <label for="scan-pages">Pages</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="scan-media" checked>
                        <label for="scan-media">Media Library</label>
                    </div>
                </div>
            </div>
            <div class="control-group">
                <label for="max-pages">Max Pages per Type:</label>
                <select id="max-pages">
                    <option value="5">5 pages</option>
                    <option value="10" selected>10 pages</option>
                    <option value="25">25 pages</option>
                    <option value="50">50 pages</option>
                    <option value="100">100 pages</option>
                </select>
            </div>
            <div class="control-group">
                <label for="storage-type">Storage:</label>
                <select id="storage-type">
                    <option value="indexeddb">IndexedDB</option>
                    <option value="local">Local Storage</option>
                </select>
            </div>
            <div class="button-group">
                <button id="scan-btn" class="btn btn-primary">Scan WordPress Site</button>
                <button id="clear-btn" class="btn btn-secondary">Clear Data</button>
            </div>
            <div id="status"></div>
        </div>

        <div class="media-library-container">
            <media-library 
                id="media-library"
                storage="indexeddb"
                locale="en">
            </media-library>
        </div>
    </div>

    <script type="module">
        import MediaLibrary from '../media-library.es.js';
        import { WordPressSource } from '../sources/index.js';
        
        // Initialize components
        const mediaLibrary = document.getElementById('media-library');
        const wordpressSource = new WordPressSource();
        
        // Get DOM elements
        const wordpressInput = document.getElementById('wordpress-url');
        const scanPostsCheck = document.getElementById('scan-posts');
        const scanPagesCheck = document.getElementById('scan-pages');
        const scanMediaCheck = document.getElementById('scan-media');
        const maxPagesSelect = document.getElementById('max-pages');
        const storageSelect = document.getElementById('storage-type');
        const scanBtn = document.getElementById('scan-btn');
        const clearBtn = document.getElementById('clear-btn');
        const statusDiv = document.getElementById('status');
        
        // Update storage type
        storageSelect.addEventListener('change', (e) => {
            mediaLibrary.storage = e.target.value;
            showStatus('Storage type changed', 'info');
        });
        
        // Scan button handler
        scanBtn.addEventListener('click', async () => {
            const wordpressUrl = wordpressInput.value.trim();
            
            if (!wordpressUrl) {
                showStatus('Please enter a WordPress site URL', 'error');
                return;
            }
            
            try {
                scanBtn.disabled = true;
                scanBtn.textContent = 'Scanning...';
                showStatus('Starting WordPress scan...', 'info');
                
                // Build options based on checkboxes
                const postTypes = [];
                if (scanPostsCheck.checked) postTypes.push('posts');
                if (scanPagesCheck.checked) postTypes.push('pages');
                
                const options = {
                    postTypes,
                    perPage: 100,
                    maxPages: parseInt(maxPagesSelect.value)
                };
                
                // Get page list from WordPress source
                const pageList = await wordpressSource.getPageList(wordpressUrl, options);
                
                showStatus(`Found ${pageList.length} pages, starting media scan...`, 'info');
                
                // Generate site key
                const siteKey = mediaLibrary.generateSiteKey(wordpressUrl);
                
                // Load pages into media library
                const mediaData = await mediaLibrary.loadFromPageList(pageList, (completed, total, found) => {
                    showStatus(`Scanning... ${completed}/${total} pages, ${found} media items found`, 'info');
                }, siteKey);
                
                // If media library scan is enabled, also get direct media items
                if (scanMediaCheck.checked) {
                    showStatus('Fetching WordPress media library items...', 'info');
                    const mediaItems = await wordpressSource.getMediaList(wordpressUrl, {
                        perPage: 100,
                        maxPages: parseInt(maxPagesSelect.value)
                    });
                    
                    // Convert media items to page format and add to existing data
                    const mediaPages = mediaItems.map(item => ({
                        url: item.url,
                        loc: item.url,
                        lastmod: item.lastmod,
                        title: item.title,
                        type: 'media',
                        mimeType: item.mimeType
                    }));
                    
                    // Add media pages to the existing page list and scan again
                    const combinedPageList = [...pageList, ...mediaPages];
                    const combinedMediaData = await mediaLibrary.loadFromPageList(combinedPageList, (completed, total, found) => {
                        showStatus(`Scanning combined content... ${completed}/${total} pages, ${found} media items found`, 'info');
                    }, siteKey);
                    
                    showStatus(`Scan complete! Found ${combinedMediaData.length} media items from ${pageList.length} pages and ${mediaItems.length} media library items`, 'success');
                } else {
                    showStatus(`Scan complete! Found ${mediaData.length} media items from ${pageList.length} pages`, 'success');
                }
                
            } catch (error) {
                showStatus(`Scan failed: ${error.message}`, 'error');
                console.error('Scan error:', error);
            } finally {
                scanBtn.disabled = false;
                scanBtn.textContent = 'Scan WordPress Site';
            }
        });
        
        // Clear button handler
        clearBtn.addEventListener('click', () => {
            mediaLibrary.clearData();
            showStatus('Data cleared', 'info');
        });
        
        // Show status message
        function showStatus(message, type = 'info') {
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // Initialize with default values
        showStatus('Ready to scan. Enter a WordPress site URL and click "Scan WordPress Site"', 'info');
    </script>
</body>
</html>
